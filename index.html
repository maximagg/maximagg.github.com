
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>西瓜熊</title>
	<meta name="author" content="西瓜熊">

	
	<meta name="description" content="简历我总是感觉好难写，以前是，现在还是。
不外乎两点：
一. 没有内容写
大学的时候读书，玩。自我评价未必比别人付出过更多的努力，虽然在兴趣使然下也看了不少书，但是因为是兴趣的原因，浅如也难深出。
杂，很多书都看。
《Linux内核完全剖析》，《操作系统设计与实现》学软件方面的知识， &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="西瓜熊" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">西瓜熊</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:maximagg.github.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:maximagg.github.com">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/01/04/guan-yu-wo-de-jian-li/">
		
			关于我的简历</a>
	</h2>
	<div class="entry-content">
		<p>简历我总是感觉好难写，以前是，现在还是。<br/>
不外乎两点：<br/>
一.   没有内容写<br/>
大学的时候读书，玩。自我评价未必比别人付出过更多的努力，虽然在兴趣使然下也看了不少书，但是因为是兴趣的原因，浅如也难深出。<br/>
杂，很多书都看。<br/>
《Linux内核完全剖析》，《操作系统设计与实现》学软件方面的知识，如果不看看内核简直就不好意思出门打招呼。一翻开书不要紧，陷到一片细节的汪洋大海里面去了。启动boot这得会汇编吧，看下汇编语法，Intel语法和AT&amp;T语法，还好虽然形式上不同但是讲的是一样的东西。可是记住内容我就忘了形式，记住了形式就纠结于形式，这是Intel语法，这是AT&amp;T语法。还好实践最重要，照着书本来敲上一遍代码，感觉心里踏实很多了，毕竟过了一遍。编译，把生成的二进制文件复制到软盘镜像文件里面去，启动虚拟机运行了一下，成功在屏幕上打印出了字符串。这时候我就感觉到了Linux系统的好处了，我安装的是Debian，各种软件一个命令了就安装起来了。Makefile自动化编译运行，让我省心了不少。然后开始看内核代码，显然大部分代码是C写的，不然C怎么能称为系统语言呢。不可避免的就要调用一些汇编写的函数，这时候就需要知道调用着和被调用着的约定了。这个过程我学到了最重要的东西就是重复的东西让电脑去做。我们需要思考的是问题是什么，如何解决问题，然后交给电脑做。碍于C的表达能力很多重复的事情我们去一次一次的重复做。重复不是生产力，却是BUG产生的重要原因。<br/>
《Unix环境高级编程》一边看书一边敲代码，调用了很多次的系统的Api，很遗憾没有因为这样敲代码而敲着敲着敲处一个很有用的软件出来。知道了一些Api，也因为枯燥了些，没有完整看完这本书。但是我觉得是一本很好的工具书，也具有不错的收藏价值。<br/>
《深入理解计算机系统》一本号称从程序员的视角，看待计算机系统的书。数据表示提到一个问题叫想当然的问题：在一个32位的机器上用int型变量来存储指针的做法，隐含了这个想法就是指针是32位长的。但是到了64位这个默认的假设条件变化了，引起了不必要的错误。
《离散数学》，《数据结构》，《算法导论》，《Opengl编程指南》，《计算机图形学》等等等。
看了这些书我看出什么来了呢，换句话说，我看了这些书我的能力提高了什么呢。第一次写简历的时候我恨不得把我所知道的所有技术概念唠叨一遍，告诉看我简历的人，这些我都是知道的，你要的以及你不要的东西我都有。现在我重新开始写简历，也是我重新开始审视自己的机会。</p>

<h2>第一个问题我到底能做什么</h2>

<p>编程语言正如简历里面介绍的我自学过的那些语言。很多时候我总是认为语言是很重要的，每种语言表达能力不同，所拥有的工具也不一样，解决的问题也不一样，适合的工具去做恰当的的事情是最重要的。<br/>
离散数学，数据结构，算法导论每个面试官都喜欢提到的，也是对每个软件工作者（我不喜欢程序员这个词，不仅仅是它代表的含义，更重要的是我对它的态度，我不想做一个编码员，而是问题的解决者。思考的角度也会决定你的解决方案优雅与否）的基本要求。但是一个问题，每个人都学习过，在工作中也不断的应用着，对这些知识的了解和应用达到了什么样多的标准才合格呢。我的理解就是这些知识是一个孰能生巧的过程，越有经验的人约能驾驭他们，唯有不断的进取，不断的提炼才能让我不再忐忑，不会疑虑我能否胜任这个问题，让我有更多的信心。</p>

<p>二.   不知道应聘着需要什么<br/>
就像面试官给我一张测试卷，里面是c++的知识测试题，对我说</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-01-04T17:10:00+00:00" pubdate data-updated="true">Jan 4<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/工作/'>工作</a>, <a class='category' href='/blog/categories/简历/'>简历</a>


</div>
	
		<span class="comments"><a href="/blog/2013/01/04/guan-yu-wo-de-jian-li//index.html#disqus_thread">Comments</a></span>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/01/04/wo-de-jian-li/">
		
			我的简历</a>
	</h2>
	<div class="entry-content">
		<p>大学我选择了信息与计算科学这个专业，我了解到它是一门交叉专业，大一大二主修数学方面的课程，和软件设计方面没有太大关系，大三开始引入软件设计和开发理论方面的学科，才真正的接触程序和软件开发。
我对这个方面特别有兴趣，也用了很多的精力。在编程语言方面我在学校仅仅学习了C语言这门非常接近硬件的命令式语言。后来我听说C++是一门有着完全不同思想的语言叫做面向对象，我就开始自学了起来，主要学习了面向对象和模板泛型这两个特性方面的知识。后来我广泛了解了很多语言的特性，我又发现了一个很有意思的语言，支持函数式的多范式语言lisp。
熟悉了C语言的语法，非常容易从计算机硬件的角度来思考程序问题，去开发各种基础的数据结构栈，队列，链表，树，图，在这门小巧的语言上我练习了很多算法，搜索，排序，遍历,二分法，贪婪算法等等。C语言对模块的划分主要通过的是开发者命名规则来实现的，对模块内部的隐藏用static这个语法以及文件的切割来实现的。
面向对象让开发大型软件变得更加的容易，对以前模块的复用变的更加自然，对开发大型软件是个非常好的解决方案。C++语言对抽象，封装，继承，多态这基本的面向对象思想有着良好的支持。但是用面向对象这样的思想去设计软件一直给我很多的困惑，有时候感觉很难下手，阅读了很多资料后，因为觉得缺少大项目的实践，依然有无米之炊的感觉。
多范式语言lisp给了我完全不同的感觉，和C++有类似的地方有都内置了基础数据结构的实现，让开发变得容易，对面向对象都有完整的支持，开发大型软件变得容易。不同之处，它支持函数式的风格。递归的思考方式，动态类型和高阶函数的支持，使得数学模型转变成软件比较直观容易。内置列表以及对列表的两个基本操作，让我们不用在纠结在指针层面去思考，而是用递归的方式去处理一个列表。复用不仅仅有面向对象这个方法，高阶函数使得对算法的复用非常的容易。lisp宏定义让我知道了元编程，开发能够改变程序的程序。
我了解到语言仅仅是实现开发软件的一个重要工具，但不是全部，软件工程这门课程给了我一个整体确又模糊的一个概念，一个软件开发的流程，工程实践各个方面的问题，及其解决方法，当然没有完美的方法，但是有一个可行工程实践。
在这个学习过程中让人沮丧的是，我大一大二学习的内容是乎没有什么用武之地。
线性代数主要讲述了有限维向量空间上的线性映射。能够比较容易在计算机中用到的地方有这些。线性映射引入的矩阵及其相关基本算数运算，加，减，乘，逆运算等等。向量空间的一维不变子空间所引入的特征值和特征向量。内积引入的规范正交基，以及正交投影。
微积分微分积分微分积分，曲线，面积，体积,速度，加速度，解析几何。这些知识还是比较容易运用到的。
实分析微积分的理论基础，这么课程讲述了很多抽象的理论，最有意思的是实数的构造，也就是由Cauchy序列来构造。
概率统计还是很容易用到的，数据挖掘这些方面。
数学建模现实中的问题用数学语言描述出来，然后在计算机上计算。
两年的工作经验让我对软件行业有了更多更深入的了解，对我自己的能力也有了新的看法。</p>

<h2>工作经历：</h2>

<p>2011-5 ~~ 2012-12 苏州美娱<br/>
* 在项目前期技术基础准备阶段，为了验证从BVH格式文件播放骨骼动画的流畅性和真实感，用c++开发了一个基于OpenGL的小的验证演示程序。<br/>
* 多种设备捕获的骨骼动作数据转换成统一格式的分析验证编码实现。<br/>
* 在猫咪中，每个玩家用自己的体感控制器控制角色，和不同的玩家一起互动。<br/>
* 独立创建和开发客户端软件，基于Unity3D游戏引擎。</p>

<p>2010-7 ~~ 2012-5 软通动力<br/>
* 参与到一个团队中从美国把一个项目转移到中国团队来。<br/>
* 转移过来后在团队中做Function Test。</p>

<h2>在这个不断变化创新的世界里，不断学习努力进取，这是我对自己现在和未来的要求。</h2>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-01-04T17:08:00+00:00" pubdate data-updated="true">Jan 4<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/工作/'>工作</a>, <a class='category' href='/blog/categories/简历/'>简历</a>


</div>
	
		<span class="comments"><a href="/blog/2013/01/04/wo-de-jian-li//index.html#disqus_thread">Comments</a></span>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/12/30/common-lisp-guang-xian-zhui-zong/">
		
			Common Lisp 光线追踪</a>
	</h2>
	<div class="entry-content">
		<p><img src="/images/blog/cl-ray-tracing.png" title="ray-tracing" alt="Alt text" /></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">sq</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">mag</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">sqrt</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nv">sq</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">sq</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">sq</span> <span class="nv">z</span><span class="p">))))</span>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">unit-vector</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">d</span> <span class="p">(</span><span class="nv">mag</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">)))</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">values</span> <span class="p">(</span><span class="nb">/</span> <span class="nv">x</span> <span class="nv">d</span><span class="p">)</span> <span class="p">(</span><span class="nb">/</span> <span class="nv">y</span> <span class="nv">d</span><span class="p">)</span> <span class="p">(</span><span class="nb">/</span> <span class="nv">z</span> <span class="nv">d</span><span class="p">))))</span>
</span><span class='line'><span class="p">(</span><span class="nb">defstruct</span> <span class="p">(</span><span class="nv">point</span> <span class="p">(</span><span class="ss">:conc-name</span> <span class="no">nil</span><span class="p">))</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">distance</span> <span class="p">(</span><span class="nv">p1</span> <span class="nv">p2</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">mag</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">p1</span><span class="p">)</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">p2</span><span class="p">))</span>
</span><span class='line'>       <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">p1</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">p2</span><span class="p">))</span>
</span><span class='line'>       <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">z</span> <span class="nv">p1</span><span class="p">)</span> <span class="p">(</span><span class="nv">z</span> <span class="nv">p2</span><span class="p">))))</span>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">minroot</span> <span class="p">(</span><span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">zerop</span> <span class="nv">a</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="nb">/</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">c</span><span class="p">)</span> <span class="nv">b</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">disc</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">sq</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="mi">4</span> <span class="nv">a</span> <span class="nv">c</span><span class="p">))))</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">minusp</span> <span class="nv">disc</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">discrt</span> <span class="p">(</span><span class="nb">sqrt</span> <span class="nv">disc</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="nb">min</span> <span class="p">(</span><span class="nb">/</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">b</span><span class="p">)</span> <span class="nv">discrt</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="mi">2</span> <span class="nv">a</span><span class="p">))</span>
</span><span class='line'>       <span class="p">(</span><span class="nb">/</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">b</span><span class="p">)</span> <span class="nv">discrt</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="mi">2</span> <span class="nv">a</span><span class="p">))))))))</span>
</span><span class='line'><span class="p">(</span><span class="nb">defstruct</span> <span class="nv">surface</span> <span class="nv">color</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nb">defparameter</span> <span class="vg">*world*</span> <span class="no">nil</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nb">defconstant</span> <span class="nv">eye</span> <span class="p">(</span><span class="nv">make-point</span> <span class="ss">:x</span> <span class="mi">0</span> <span class="ss">:y</span> <span class="mi">0</span> <span class="ss">:z</span> <span class="mi">200</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">tracer</span> <span class="p">(</span><span class="nb">pathname</span> <span class="k">&amp;optional</span> <span class="p">(</span><span class="nv">res</span> <span class="mi">1</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">with-open-file</span> <span class="p">(</span><span class="nv">p</span> <span class="nb">pathname</span> <span class="ss">:direction</span> <span class="ss">:output</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">format</span> <span class="nv">p</span> <span class="s">&quot;P2 ~A ~A 255&quot;</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">res</span> <span class="mi">100</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">res</span> <span class="mi">100</span><span class="p">))</span>
</span><span class='line'>    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">inc</span> <span class="p">(</span><span class="nb">/</span> <span class="nv">res</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="nb">do</span> <span class="p">((</span><span class="nv">y</span> <span class="mi">-50</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">y</span> <span class="nv">inc</span><span class="p">)))</span>
</span><span class='line'>    <span class="p">((</span><span class="nb">&lt;</span> <span class="p">(</span><span class="nb">-</span> <span class="mi">50</span> <span class="nv">y</span><span class="p">)</span> <span class="nv">inc</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">do</span> <span class="p">((</span><span class="nv">x</span> <span class="mi">-50</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">x</span> <span class="nv">inc</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">((</span><span class="nb">&lt;</span> <span class="p">(</span><span class="nb">-</span> <span class="mi">50</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">inc</span><span class="p">))</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">print</span> <span class="p">(</span><span class="nv">color-at</span> <span class="nv">x</span> <span class="nv">y</span> <span class="p">)</span> <span class="nv">p</span><span class="p">))))))</span>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">color-at</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">multiple-value-bind</span> <span class="p">(</span><span class="nv">xr</span> <span class="nv">yr</span> <span class="nv">zr</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="nv">unit-vector</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">x</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">eye</span><span class="p">))</span>
</span><span class='line'>         <span class="p">(</span><span class="nb">-</span> <span class="nv">y</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">eye</span><span class="p">))</span>
</span><span class='line'>         <span class="p">(</span><span class="nb">-</span> <span class="mi">0</span> <span class="p">(</span><span class="nv">z</span> <span class="nv">eye</span><span class="p">)))</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">round</span> <span class="p">(</span><span class="nb">*</span> <span class="p">(</span><span class="nv">sendray</span> <span class="nv">eye</span> <span class="nv">xr</span> <span class="nv">yr</span> <span class="nv">zr</span><span class="p">)</span> <span class="mi">255</span><span class="p">))))</span>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">sendray</span> <span class="p">(</span><span class="nv">pt</span> <span class="nv">xr</span> <span class="nv">yr</span> <span class="nv">zr</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">multiple-value-bind</span> <span class="p">(</span><span class="nv">s</span> <span class="nv">int</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="nv">first-hit</span> <span class="nv">pt</span> <span class="nv">xr</span> <span class="nv">yr</span> <span class="nv">zr</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="k">if</span> <span class="nv">s</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">*</span> <span class="p">(</span><span class="nv">lambert</span> <span class="nv">s</span> <span class="nv">int</span> <span class="nv">xr</span> <span class="nv">yr</span> <span class="nv">zr</span><span class="p">)</span> <span class="p">(</span><span class="nv">surface-color</span> <span class="nv">s</span><span class="p">))</span>
</span><span class='line'>  <span class="mi">0</span><span class="p">)))</span>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">first-hit</span> <span class="p">(</span><span class="nv">pt</span> <span class="nv">xr</span> <span class="nv">yr</span> <span class="nv">zr</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">surface</span> <span class="nv">hit</span> <span class="nv">dist</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">s</span> <span class="vg">*world*</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">h</span> <span class="p">(</span><span class="nv">intersect</span> <span class="nv">s</span> <span class="nv">pt</span> <span class="nv">xr</span> <span class="nv">yr</span> <span class="nv">zr</span><span class="p">)))</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">when</span> <span class="nv">h</span>
</span><span class='line'>    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">d</span> <span class="p">(</span><span class="nv">distance</span> <span class="nv">h</span> <span class="nv">pt</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nb">null</span> <span class="nv">dist</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt;</span> <span class="nv">d</span> <span class="nv">dist</span><span class="p">))</span>
</span><span class='line'>        <span class="p">(</span><span class="nb">setf</span> <span class="nv">surface</span> <span class="nv">s</span> <span class="nv">hit</span> <span class="nv">h</span> <span class="nv">dist</span> <span class="nv">d</span><span class="p">))))))</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">values</span> <span class="nv">surface</span> <span class="nv">hit</span><span class="p">)))</span>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">lambert</span> <span class="p">(</span><span class="nv">s</span> <span class="nv">int</span> <span class="nv">xr</span> <span class="nv">yr</span> <span class="nv">zr</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">multiple-value-bind</span> <span class="p">(</span><span class="nv">xn</span> <span class="nv">yn</span> <span class="nv">zn</span><span class="p">)</span> <span class="p">(</span><span class="nv">normal</span> <span class="nv">s</span> <span class="nv">int</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">max</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">xr</span> <span class="nv">xn</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">yr</span> <span class="nv">yn</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">zr</span> <span class="nv">zn</span><span class="p">)))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nb">defstruct</span> <span class="p">(</span><span class="nv">sphere</span> <span class="p">(</span><span class="ss">:incude</span> <span class="nv">surface</span><span class="p">))</span>
</span><span class='line'>  <span class="nv">radius</span> <span class="nv">center</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">defsphere</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span> <span class="nv">r</span> <span class="nv">c</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">s</span> <span class="p">(</span><span class="nv">make-sphere</span>
</span><span class='line'>      <span class="ss">:radius</span> <span class="nv">r</span>
</span><span class='line'>      <span class="ss">:center</span> <span class="p">(</span><span class="nv">make-point</span> <span class="ss">:x</span> <span class="nv">x</span> <span class="ss">:y</span> <span class="nv">y</span> <span class="ss">:z</span> <span class="nv">z</span><span class="p">)</span>
</span><span class='line'>      <span class="ss">:color</span> <span class="nv">c</span><span class="p">)))</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">push</span> <span class="nv">s</span> <span class="vg">*world*</span><span class="p">)</span>
</span><span class='line'>    <span class="nv">s</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">intersect</span> <span class="p">(</span><span class="nv">s</span> <span class="nv">pt</span> <span class="nv">xr</span> <span class="nv">yr</span> <span class="nv">zr</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">funcall</span> <span class="p">(</span><span class="nb">typecase</span> <span class="nv">s</span> <span class="p">(</span><span class="nv">sphere</span> <span class="nf">#&#39;</span><span class="nv">sphere-intersect</span><span class="p">))</span>
</span><span class='line'>     <span class="nv">s</span> <span class="nv">pt</span> <span class="nv">xr</span> <span class="nv">yr</span> <span class="nv">zr</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">sphere-intersect</span> <span class="p">(</span><span class="nv">s</span> <span class="nv">pt</span> <span class="nv">xr</span> <span class="nv">yr</span> <span class="nv">zr</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">c</span> <span class="p">(</span><span class="nv">shpere-center</span> <span class="nv">s</span><span class="p">))</span>
</span><span class='line'>   <span class="p">(</span><span class="nv">n</span> <span class="p">(</span><span class="nv">minroot</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nv">sq</span> <span class="nv">xr</span><span class="p">)</span> <span class="p">(</span><span class="nv">sq</span> <span class="nv">yr</span><span class="p">)</span> <span class="p">(</span><span class="nv">sq</span> <span class="nv">zr</span><span class="p">))</span>
</span><span class='line'>           <span class="p">(</span><span class="nb">*</span> <span class="mi">2</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">*</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">pt</span><span class="p">)</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">c</span><span class="p">))</span> <span class="nv">xr</span><span class="p">)</span>
</span><span class='line'>               <span class="p">(</span><span class="nb">*</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">pt</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">c</span><span class="p">))</span> <span class="nv">yr</span><span class="p">)</span>
</span><span class='line'>               <span class="p">(</span><span class="nb">*</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">z</span> <span class="nv">pt</span><span class="p">)</span> <span class="p">(</span><span class="nv">z</span> <span class="nv">c</span><span class="p">))</span> <span class="nv">zr</span><span class="p">)))</span>
</span><span class='line'>           <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nv">sq</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">pt</span><span class="p">)</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">c</span><span class="p">)))</span>
</span><span class='line'>          <span class="p">(</span><span class="nv">sq</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">pt</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">c</span><span class="p">)))</span>
</span><span class='line'>          <span class="p">(</span><span class="nv">sq</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">z</span> <span class="nv">pt</span><span class="p">)</span> <span class="p">(</span><span class="nv">z</span> <span class="nv">c</span><span class="p">)))</span>
</span><span class='line'>          <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">sq</span> <span class="p">(</span><span class="nv">sphere-radius</span> <span class="nv">s</span><span class="p">)))))))</span>
</span><span class='line'>    <span class="p">(</span><span class="k">if</span> <span class="nv">n</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">make-point</span> <span class="ss">:x</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">pt</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">n</span> <span class="nv">xr</span><span class="p">))</span>
</span><span class='line'>          <span class="ss">:y</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">pt</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">n</span> <span class="nv">yr</span><span class="p">))</span>
</span><span class='line'>          <span class="ss">:z</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nv">z</span> <span class="nv">pt</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">n</span> <span class="nv">zr</span><span class="p">))))))</span>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">normal</span> <span class="p">(</span><span class="nv">s</span> <span class="nv">pt</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">funcall</span> <span class="p">(</span><span class="nb">typecase</span> <span class="nv">s</span> <span class="p">(</span><span class="nv">sphere-normal</span><span class="p">))</span>
</span><span class='line'>     <span class="nv">s</span> <span class="nv">pt</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">sphere-normal</span> <span class="p">(</span><span class="nv">s</span> <span class="nv">pt</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">c</span> <span class="p">(</span><span class="nv">sphere-center</span> <span class="nv">s</span><span class="p">)))</span>
</span><span class='line'>    <span class="p">(</span><span class="nv">unit-vector</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">c</span><span class="p">)</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">pt</span><span class="p">))</span>
</span><span class='line'>       <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">c</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">pt</span><span class="p">))</span>
</span><span class='line'>       <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">z</span> <span class="nv">c</span><span class="p">)</span> <span class="p">(</span><span class="nv">z</span> <span class="nv">pt</span><span class="p">)))))</span>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">ray-test</span> <span class="p">(</span><span class="k">&amp;optional</span> <span class="p">(</span><span class="nv">res</span> <span class="mi">1</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">setf</span> <span class="vg">*world*</span> <span class="no">nil</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">defsphere</span> <span class="mi">0</span> <span class="mi">-300</span> <span class="mi">-1200</span> <span class="mi">200</span> <span class="mf">.8</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">defsphere</span> <span class="mi">-80</span> <span class="mi">-150</span> <span class="mi">-1200</span> <span class="mi">200</span> <span class="mf">.7</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">defsphere</span> <span class="mi">70</span> <span class="mi">-100</span> <span class="mi">-1200</span> <span class="mi">200</span> <span class="mf">.9</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">do</span> <span class="p">((</span><span class="nv">x</span> <span class="mi">-2</span> <span class="p">(</span><span class="nb">1+</span> <span class="nv">x</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">((</span><span class="nb">&gt;</span> <span class="nv">x</span> <span class="mi">2</span><span class="p">))</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">do</span> <span class="p">((</span><span class="nv">z</span> <span class="mi">2</span> <span class="p">(</span><span class="nb">1+</span> <span class="nv">z</span><span class="p">)))</span>
</span><span class='line'>        <span class="p">((</span><span class="nb">&gt;</span> <span class="nv">z</span> <span class="mi">7</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="nv">defsphere</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">x</span> <span class="mi">200</span><span class="p">)</span> <span class="mi">300</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">z</span> <span class="mi">-400</span><span class="p">)</span> <span class="mi">40</span> <span class="mf">.75</span><span class="p">)))</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">tracer</span> <span class="p">(</span><span class="nb">make-pathname</span> <span class="ss">:name</span> <span class="s">&quot;spheres.pgm&quot;</span><span class="p">)</span> <span class="nv">res</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-12-30T16:36:00+00:00" pubdate data-updated="true">Dec 30<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/common-lisp/'>Common Lisp</a>, <a class='category' href='/blog/categories/lisp/'>lisp</a>


</div>
	
		<span class="comments"><a href="/blog/2012/12/30/common-lisp-guang-xian-zhui-zong//index.html#disqus_thread">Comments</a></span>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/12/30/common-lisp-kong-zhi-liu/">
		
			Common Lisp 控制流</a>
	</h2>
	<div class="entry-content">
		<h2>区块blocks</h2>

<p>common lisp 有三个构造区块block的基本操作符.<br/>
在 progn 主体中的表达式会依序求值，并返回最後一个表达式的值:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="k">progn</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;a&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;b&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">+</span> <span class="mi">11</span> <span class="mi">12</span><span class="p">))</span> <span class="c1">;; return 23</span>
</span></code></pre></td></tr></table></div></figure>


<p>一个 block 像是带有名字及紧急出口的 progn.第一个实参应为符号.这成为了区块的名字.在主体中的任何地方,可以停止求值,并通过使用 return-from 指定区块的名字,来立即返回数值:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="k">block</span> <span class="nv">block-name</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;Here we go.&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">return-from</span> <span class="nv">block-name</span> <span class="ss">&#39;with-return-value</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">11</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="k">block</span> <span class="no">nil</span>
</span><span class='line'>  <span class="p">(</span><span class="k">block</span> <span class="nv">block-name</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;Here we go.&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">return</span> <span class="ss">&#39;return-from-nil</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="k">return-from</span> <span class="nv">block-name</span> <span class="ss">&#39;with-return-value</span><span class="p">)</span>
</span><span class='line'>    <span class="ss">&#39;not-arrived</span><span class="p">))</span> 
</span></code></pre></td></tr></table></div></figure>


<p>许多接受一个表达式主体的 Common Lisp 操作符,皆隐含在一个叫做 nil 的区块里.比如，所有由 do 构造的迭代函数:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">x</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">e</span> <span class="nv">f</span> <span class="nv">g</span> <span class="nv">h</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~A &quot;</span> <span class="nv">x</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">eql</span> <span class="nv">x</span> <span class="ss">&#39;f</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="nb">return</span> <span class="ss">&#39;done</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>defun 定义的函数,都隐含在一个与函数同名的区块里面：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">foo</span> <span class="p">()</span>
</span><span class='line'>  <span class="p">(</span><span class="k">return-from</span> <span class="nv">foo</span> <span class="ss">&#39;ok</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>带标签labels的块:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="k">tagbody</span>
</span><span class='line'>   <span class="p">(</span><span class="nb">setf</span> <span class="nv">x</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">top-label</span>
</span><span class='line'>   <span class="p">(</span><span class="nb">setf</span> <span class="nv">x</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">x</span> <span class="mi">1</span><span class="p">))</span>
</span><span class='line'>   <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~A &quot;</span> <span class="nv">x</span><span class="p">)</span>
</span><span class='line'>   <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&lt;</span> <span class="nv">x</span> <span class="mi">10</span><span class="p">)</span> <span class="p">(</span><span class="k">go</span> <span class="nv">top-label</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<h2>语境contex</h2>

<p>let 操作符创造出一个新的语法语境lexical context</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="c1">;; 两个表达式等价</span>
</span><span class='line'><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">x</span> <span class="mi">7</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="nv">y</span> <span class="mi">8</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">+</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
</span><span class='line'><span class="p">((</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
</span><span class='line'>   <span class="p">(</span><span class="nb">+</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
</span><span class='line'>   <span class="mi">7</span> <span class="mi">8</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>条件conditionals</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="k">if</span> <span class="no">t</span> <span class="ss">&#39;ok</span> <span class="ss">&#39;nil</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="k">if</span> <span class="no">nil</span> <span class="ss">&#39;nil</span> <span class="ss">&#39;ok</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nb">when</span> <span class="no">t</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">+</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span> <span class="c1">;; 6</span>
</span><span class='line'><span class="p">(</span><span class="nb">unless</span> <span class="no">nil</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">+</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">))</span> <span class="c1">;; 9</span>
</span><span class='line'><span class="p">(</span><span class="nb">cond</span>
</span><span class='line'>  <span class="p">(</span><span class="no">nil</span> <span class="ss">&#39;not-here</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="no">t</span> <span class="ss">&#39;here</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="no">t</span> <span class="ss">&#39;here-or-not</span><span class="p">))</span> <span class="c1">;; HERE</span>
</span></code></pre></td></tr></table></div></figure>


<h2>迭代iteration</h2>

<p>最基本的是 do</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="nb">do</span> <span class="p">((</span><span class="nv">i</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">i</span> <span class="mi">1</span><span class="p">))</span>
</span><span class='line'>     <span class="p">(</span><span class="nv">j</span> <span class="mi">0</span> <span class="nv">i</span><span class="p">))</span>
</span><span class='line'>    <span class="p">((</span><span class="nb">&gt;</span> <span class="nv">i</span> <span class="mi">10</span><span class="p">)</span> <span class="ss">&#39;done</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~A &quot;</span> <span class="nv">j</span><span class="p">))</span> <span class="c1">;; 0 0 1 2 3 4 5 6 7 8 9</span>
</span></code></pre></td></tr></table></div></figure>


<h2>多值multiple values</h2>

<p>返回多值</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="nb">values</span> <span class="ss">&#39;a</span> <span class="ss">&#39;b</span> <span class="ss">&#39;c</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>接受多值</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="nb">multiple-value-bind</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nb">values</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">list</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="k">multiple-value-call</span> <span class="nf">#&#39;</span><span class="nb">+</span> <span class="p">(</span><span class="nb">values</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nb">multiple-value-list</span> <span class="p">(</span><span class="nb">values</span> <span class="ss">&#39;a</span> <span class="ss">&#39;b</span> <span class="ss">&#39;c</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<h2>终止aborts</h2>

<p>return 在任何时候可以离开一个 block.<br/>
catch 和 throw 从函数中把控制权转移过来.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">super</span> <span class="p">()</span>
</span><span class='line'>  <span class="p">(</span><span class="k">catch</span> <span class="ss">&#39;abort</span>
</span><span class='line'>    <span class="p">(</span><span class="nv">sub</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nv">farmat</span> <span class="no">t</span> <span class="s">&quot;We&#39;ll never see this.&quot;</span><span class="p">)))</span>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">sub</span> <span class="p">()</span>
</span><span class='line'>  <span class="p">(</span><span class="k">throw</span> <span class="ss">&#39;abort</span> <span class="mi">99</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<h2>函数functions</h2>

<p>局部函数 使用 labels 定义.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="k">labels</span> <span class="p">((</span><span class="nv">add10</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="mi">10</span> <span class="nv">x</span><span class="p">))</span>
</span><span class='line'>   <span class="p">(</span><span class="nv">add99</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="mi">99</span> <span class="nv">x</span><span class="p">)))</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">add99</span> <span class="p">(</span><span class="nv">add10</span> <span class="mi">10</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>参数列表parameter lists
普通参数又称为必要参数
可选参数   &amp;optional
剩余参数   &amp;rest
关键字参数 &amp;key</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-12-30T14:48:00+00:00" pubdate data-updated="true">Dec 30<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/common-lisp/'>Common Lisp</a>, <a class='category' href='/blog/categories/lisp/'>lisp</a>


</div>
	
		<span class="comments"><a href="/blog/2012/12/30/common-lisp-kong-zhi-liu//index.html#disqus_thread">Comments</a></span>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/12/30/xu-qiu-jue-ding-shi-xian/">
		
			需求决定实现</a>
	</h2>
	<div class="entry-content">
		

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-12-30T00:27:00+00:00" pubdate data-updated="true">Dec 30<span>th</span>, 2012</time></div>
	<div class="tags">

</div>
	
		<span class="comments"><a href="/blog/2012/12/30/xu-qiu-jue-ding-shi-xian//index.html#disqus_thread">Comments</a></span>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/12/29/common-lisp-ji-chu-shu-ju-jie-gou/">
		
			Common Lisp 基础数据结构</a>
	</h2>
	<div class="entry-content">
		<h2>构建conses</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="nb">setf</span> <span class="nv">a-cons</span> <span class="p">(</span><span class="nb">cons</span> <span class="ss">&#39;a</span> <span class="no">nil</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nb">car</span> <span class="nv">a-cons</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nb">cdr</span> <span class="nv">a-cons</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nb">equal</span> <span class="p">(</span><span class="nb">cons</span> <span class="ss">&#39;a</span>
</span><span class='line'>       <span class="p">(</span><span class="nb">cons</span> <span class="ss">&#39;b</span>
</span><span class='line'>         <span class="p">(</span><span class="nb">cons</span> <span class="ss">&#39;c</span> <span class="no">nil</span><span class="p">)))</span>
</span><span class='line'>       <span class="p">(</span><span class="nb">list</span> <span class="ss">&#39;a</span> <span class="ss">&#39;b</span> <span class="ss">&#39;c</span><span class="p">))</span>  <span class="c1">;;T</span>
</span><span class='line'><span class="p">(</span><span class="nb">consp</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">x</span><span class="p">))</span> <span class="c1">;;T</span>
</span><span class='line'><span class="p">(</span><span class="nb">consp</span> <span class="ss">&#39;x</span><span class="p">)</span> <span class="c1">;;NIL</span>
</span></code></pre></td></tr></table></div></figure>


<h2>列表lists</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="nb">copy-list</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="nv">a</span> <span class="mi">6</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nb">cons</span> <span class="ss">&#39;a</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nb">car</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nb">cdr</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Run length encoding</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">compress</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">consp</span> <span class="nv">x</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="nv">compr</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">1</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">x</span><span class="p">))</span>
</span><span class='line'>      <span class="nv">x</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">compr</span> <span class="p">(</span><span class="nb">elt</span> <span class="nv">n</span> <span class="nv">lst</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null</span> <span class="nv">lst</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nv">n-elts</span> <span class="nb">elt</span> <span class="nv">n</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">next</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">lst</span><span class="p">)))</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">eql</span> <span class="nv">next</span> <span class="nb">elt</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="nv">compr</span> <span class="nb">elt</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">n</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">lst</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nv">n-elts</span> <span class="nb">elt</span> <span class="nv">n</span><span class="p">)</span>
</span><span class='line'>        <span class="p">(</span><span class="nv">compr</span> <span class="nv">next</span> <span class="mi">1</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">lst</span><span class="p">)))))))</span>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">n-elts</span> <span class="p">(</span><span class="nb">elt</span> <span class="nv">n</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="nv">n</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="nb">list</span> <span class="nv">n</span> <span class="nb">elt</span><span class="p">)</span>
</span><span class='line'>      <span class="nb">elt</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nb">setf</span> <span class="nv">a-compress-list</span> <span class="p">(</span><span class="nv">compress</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">10</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)))</span>
</span><span class='line'><span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~A&quot;</span> <span class="nv">a-compress-list</span><span class="p">)</span> <span class="c1">;;(10 (9 1) (6 8) (2 1) (8 2) 3)</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">uncompress</span> <span class="p">(</span><span class="nv">lst</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null</span> <span class="nv">lst</span><span class="p">)</span>
</span><span class='line'>      <span class="no">nil</span>
</span><span class='line'>      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nb">elt</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">lst</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="nb">rest</span> <span class="p">(</span><span class="nv">uncompress</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">lst</span><span class="p">))))</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">consp</span> <span class="nb">elt</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="nb">append</span> <span class="p">(</span><span class="nb">apply</span> <span class="nf">#&#39;</span><span class="nv">list-of</span> <span class="nb">elt</span><span class="p">)</span>
</span><span class='line'>          <span class="nb">rest</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="nb">cons</span> <span class="nb">elt</span> <span class="nb">rest</span><span class="p">)))))</span>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">list-of</span> <span class="p">(</span><span class="nv">n</span> <span class="nb">elt</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">zerop</span> <span class="nv">n</span><span class="p">)</span>
</span><span class='line'>      <span class="no">nil</span>
</span><span class='line'>      <span class="p">(</span><span class="nb">cons</span> <span class="nb">elt</span> <span class="p">(</span><span class="nv">list-of</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">n</span> <span class="mi">1</span><span class="p">)</span> <span class="nb">elt</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nv">uncompress</span> <span class="nv">a-compress-list</span><span class="p">)</span> <span class="c1">;;(10 1 1 1 1 1 1 1 1 1 8 8 8 8 8 8 1 1 2 2 2 2 2 2 2 2 3)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Mapping Functions</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="nb">mapcar</span> <span class="nf">#&#39;</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~A &quot;</span> <span class="nv">x</span><span class="p">))</span> <span class="o">&#39;</span><span class="p">(</span> <span class="s">&quot;Hello&quot;</span> <span class="mi">1</span> <span class="mi">2</span> <span class="ss">&#39;a</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<h2>树trees</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">our-copy-tree</span> <span class="p">(</span><span class="nv">tr</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">atom</span> <span class="nv">tr</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">tr</span>
</span><span class='line'>      <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nv">our-copy-tree</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">tr</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="nv">our-copy-tree</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">tr</span><span class="p">)))))</span>
</span></code></pre></td></tr></table></div></figure>


<h2>集合sets</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="nb">member</span> <span class="ss">&#39;b</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">e</span> <span class="nv">f</span> <span class="nv">g</span> <span class="nv">h</span><span class="p">))</span> <span class="c1">;;(B C D E F G H)</span>
</span><span class='line'><span class="p">(</span><span class="nb">member-if-not</span> <span class="nf">#&#39;</span><span class="nb">oddp</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nb">adjoin</span> <span class="ss">&#39;a</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nb">union</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">e</span> <span class="nv">f</span> <span class="nv">g</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nb">intersection</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">e</span> <span class="nv">f</span> <span class="nv">g</span> <span class="nv">h</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">e</span> <span class="nv">f</span> <span class="nv">g</span> <span class="nv">h</span> <span class="mi">0</span> <span class="mi">9</span> <span class="mi">8</span> <span class="mi">7</span> <span class="mi">6</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nb">set-difference</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">e</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="nv">d</span> <span class="nv">e</span> <span class="nv">g</span> <span class="nv">h</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<h2>序列sequences</h2>

<p>序列包括list vector string</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="nb">length</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">e</span> <span class="nv">f</span> <span class="nv">g</span> <span class="nv">h</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nb">subseq</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">e</span> <span class="nv">f</span> <span class="nv">g</span> <span class="nv">h</span><span class="p">)</span> <span class="mi">0</span> <span class="mi">7</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nb">reverse</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">e</span> <span class="nv">f</span> <span class="nv">g</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nb">reverse</span> <span class="s">&quot;abcdefg123456&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">mirror?</span> <span class="p">(</span><span class="nv">s</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">len</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">s</span><span class="p">)))</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">evenp</span> <span class="nv">len</span><span class="p">)</span>
</span><span class='line'>   <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">mid</span> <span class="p">(</span><span class="nb">/</span> <span class="nv">len</span> <span class="mi">2</span><span class="p">)))</span>
</span><span class='line'>     <span class="p">(</span><span class="nb">equal</span> <span class="p">(</span><span class="nb">subseq</span> <span class="nv">s</span> <span class="mi">0</span> <span class="nv">mid</span><span class="p">)</span>
</span><span class='line'>        <span class="p">(</span><span class="nb">reverse</span> <span class="p">(</span><span class="nb">subseq</span> <span class="nv">s</span> <span class="nv">mid</span><span class="p">)))))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nv">mirror?</span> <span class="s">&quot;aa&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nb">setf</span> <span class="nv">a-list-num</span>  <span class="o">&#39;</span><span class="p">(</span><span class="mi">0</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">11</span> <span class="mi">22</span> <span class="mi">5</span> <span class="mi">44</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nb">equal</span> <span class="p">(</span><span class="nb">sort</span> <span class="nv">a-list-num</span> <span class="nf">#&#39;</span><span class="nb">&gt;</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">0</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">11</span> <span class="mi">22</span> <span class="mi">5</span> <span class="mi">44</span><span class="p">))</span> <span class="c1">;; NIL sort is destructive</span>
</span></code></pre></td></tr></table></div></figure>


<p>栈stacks</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="c1">;; pushdown stack</span>
</span><span class='line'><span class="p">(</span><span class="nb">setf</span> <span class="nv">a-stack</span> <span class="no">nil</span><span class="p">)</span>
</span><span class='line'><span class="c1">;; use cons</span>
</span><span class='line'><span class="p">(</span><span class="nb">push</span> <span class="ss">&#39;a</span> <span class="nv">a-stack</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nb">pop</span> <span class="nv">a-stack</span><span class="p">)</span>
</span><span class='line'><span class="c1">;; use adjoin</span>
</span><span class='line'><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">x</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="nv">b</span><span class="p">)))</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">pushnew</span> <span class="ss">&#39;c</span> <span class="nv">x</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">pushnew</span> <span class="ss">&#39;a</span> <span class="nv">x</span><span class="p">)</span>
</span><span class='line'>  <span class="nv">x</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>点状列表dotted lists</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="nb">equal</span> <span class="p">(</span><span class="nb">cons</span> <span class="ss">&#39;a</span> <span class="ss">&#39;b</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="o">.</span> <span class="nv">b</span><span class="p">))</span> <span class="c1">;;T</span>
</span><span class='line'><span class="p">(</span><span class="nb">equal</span> <span class="p">(</span><span class="nb">cons</span> <span class="ss">&#39;a</span> <span class="ss">&#39;b</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="nv">b</span><span class="p">))</span> <span class="c1">;;NIL</span>
</span><span class='line'><span class="p">(</span><span class="nb">equal</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">e</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="o">.</span> <span class="p">(</span><span class="nv">b</span> <span class="o">.</span> <span class="p">(</span><span class="nv">c</span> <span class="o">.</span> <span class="p">(</span><span class="nv">d</span> <span class="o">.</span> <span class="p">(</span><span class="nv">e</span> <span class="o">.</span> <span class="no">nil</span><span class="p">))))))</span> <span class="c1">;;T</span>
</span><span class='line'><span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="o">.</span> <span class="nv">d</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>关联列表assoc-lists</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="nb">setf</span> <span class="nv">a-assoc</span> <span class="o">&#39;</span><span class="p">((</span><span class="nb">+</span> <span class="o">.</span> <span class="s">&quot;add&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="nb">-</span> <span class="o">.</span> <span class="s">&quot;substract&quot;</span><span class="p">)))</span>
</span><span class='line'><span class="p">(</span><span class="nb">assoc</span> <span class="ss">&#39;+</span> <span class="nv">a-assoc</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>有向图最短路径shortest path</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="nb">setf</span> <span class="nv">a-graph</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="nv">c</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="nv">d</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/blog/cl-a-graph.png" title="assoc-lists" alt="Alt text" /></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">shortest-path</span> <span class="p">(</span><span class="nv">start</span> <span class="nv">end</span> <span class="nv">graph</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">bfs</span> <span class="nv">end</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">start</span><span class="p">))</span> <span class="nv">graph</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">bfs</span> <span class="p">(</span><span class="nv">end</span> <span class="nv">queue</span> <span class="nv">graph</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null</span> <span class="nv">graph</span><span class="p">)</span>
</span><span class='line'>      <span class="no">nil</span>
</span><span class='line'>      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">path</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">queue</span><span class="p">)))</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">node</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">path</span><span class="p">)))</span>
</span><span class='line'>    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">eql</span> <span class="nv">node</span> <span class="nv">end</span><span class="p">)</span>
</span><span class='line'>        <span class="p">(</span><span class="nb">reverse</span> <span class="nv">path</span><span class="p">)</span>
</span><span class='line'>        <span class="p">(</span><span class="nv">bfs</span> <span class="nv">end</span>
</span><span class='line'>         <span class="p">(</span><span class="nb">append</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">queue</span><span class="p">)</span>
</span><span class='line'>             <span class="p">(</span><span class="nv">new-paths</span> <span class="nv">path</span> <span class="nv">node</span> <span class="nv">graph</span><span class="p">))</span>
</span><span class='line'>         <span class="nv">graph</span><span class="p">))))))</span>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">new-paths</span> <span class="p">(</span><span class="nv">path</span> <span class="nv">node</span> <span class="nv">graph</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">mapcar</span> <span class="nf">#&#39;</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">n</span><span class="p">)</span>
</span><span class='line'>        <span class="p">(</span><span class="nb">cons</span> <span class="nv">n</span> <span class="nv">path</span><span class="p">))</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">cdr</span> <span class="p">(</span><span class="nb">assoc</span> <span class="nv">node</span> <span class="nv">graph</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nv">shortest-path</span> <span class="ss">&#39;a</span> <span class="ss">&#39;d</span> <span class="nv">a-graph</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>数组array</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="nb">setf</span> <span class="nv">a-array</span> <span class="p">(</span><span class="nb">make-array</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">2</span> <span class="mi">3</span><span class="p">)</span> <span class="ss">:initial-element</span> <span class="mi">0</span><span class="p">))</span> <span class="c1">;;#2A((0 0 0) (0 0 0))</span>
</span><span class='line'><span class="p">(</span><span class="nb">aref</span> <span class="nv">a-array</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nb">aref</span> <span class="nv">a-array</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span> <span class="ss">&#39;a1</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nb">setf</span> <span class="nv">sec-array</span> <span class="p">(</span><span class="nb">make-array</span> <span class="mi">3</span> <span class="ss">:initial-element</span> <span class="mi">2</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nb">equal</span> <span class="nv">sec-array</span> <span class="p">(</span><span class="nb">vector</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span><span class="p">))</span> <span class="c1">;;NIL</span>
</span></code></pre></td></tr></table></div></figure>


<h2>二分搜索binary search</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">bin-search</span> <span class="p">(</span><span class="nv">obj</span> <span class="nv">vec</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">len</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">vec</span><span class="p">)))</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">zerop</span> <span class="nv">len</span><span class="p">))</span>
</span><span class='line'>   <span class="p">(</span><span class="nv">finder</span> <span class="nv">obj</span> <span class="nv">vec</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">len</span> <span class="mi">1</span><span class="p">)))))</span>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">finder</span> <span class="p">(</span><span class="nv">obj</span> <span class="nv">vec</span> <span class="nv">start</span> <span class="nv">end</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~A~%&quot;</span> <span class="p">(</span><span class="nb">subseq</span> <span class="nv">vec</span> <span class="nv">start</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">end</span> <span class="mi">1</span><span class="p">)))</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">range</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">end</span> <span class="nv">start</span><span class="p">)))</span>
</span><span class='line'>    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">zerop</span> <span class="nv">range</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">eql</span> <span class="nv">obj</span> <span class="p">(</span><span class="nb">aref</span> <span class="nv">vec</span> <span class="nv">start</span><span class="p">))</span>
</span><span class='line'>      <span class="nv">obj</span>
</span><span class='line'>      <span class="no">nil</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">mid</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">start</span> <span class="p">(</span><span class="nb">round</span> <span class="p">(</span><span class="nb">/</span> <span class="nv">range</span> <span class="mi">2</span><span class="p">)))))</span>
</span><span class='line'>    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">obj2</span> <span class="p">(</span><span class="nb">aref</span> <span class="nv">vec</span> <span class="nv">mid</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&lt;</span> <span class="nv">obj</span> <span class="nv">obj2</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="nv">finder</span> <span class="nv">obj</span> <span class="nv">vec</span> <span class="nv">start</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">mid</span> <span class="mi">1</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="nv">obj</span> <span class="nv">obj2</span><span class="p">)</span>
</span><span class='line'>          <span class="p">(</span><span class="nv">finder</span> <span class="nv">obj</span> <span class="nv">vec</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">mid</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">end</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">obj</span><span class="p">)))))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nv">bin-search</span> <span class="mi">3</span> <span class="o">#(</span><span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mi">11</span> <span class="mi">12</span> <span class="mi">13</span> <span class="mi">14</span> <span class="mi">15</span> <span class="mi">16</span> <span class="mi">17</span> <span class="mi">18</span> <span class="mi">19</span> <span class="mi">20</span><span class="p">))</span>
</span><span class='line'><span class="c1">;; #(0 1 2 3 4 5 6 7 9 10 11 12 13 14 15 16 17 18 19 20)</span>
</span><span class='line'><span class="c1">;; #(12 13 14 15 16 17 18 19 20)</span>
</span><span class='line'><span class="c1">;; #(12 13 14 15)</span>
</span><span class='line'><span class="c1">;; #(12 13)</span>
</span><span class='line'><span class="c1">;; #(13)</span>
</span><span class='line'><span class="c1">;; 13</span>
</span></code></pre></td></tr></table></div></figure>


<h2>结构structures</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="nb">defstruct</span> <span class="nv">point</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nb">setf</span> <span class="nv">a-point</span> <span class="p">(</span><span class="nv">make-point</span> <span class="ss">:x</span> <span class="mi">1</span> <span class="ss">:y</span> <span class="mi">2</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nv">point-x</span> <span class="nv">a-point</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nv">point-y</span> <span class="nv">a-point</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nv">point-p</span> <span class="nv">a-point</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nb">typep</span> <span class="nv">a-point</span> <span class="ss">&#39;point</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nb">defstruct</span> <span class="nv">polemic</span>
</span><span class='line'>  <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="k">progn</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;What kind of polemic was it? &quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">read</span><span class="p">)))</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">effect</span> <span class="no">nil</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nv">make-polemic</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>哈希表hash table</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="nb">setf</span> <span class="nv">a-ht</span> <span class="p">(</span><span class="nb">make-hash-table</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nb">gethash</span> <span class="ss">&#39;color</span> <span class="nv">a-ht</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nb">gethash</span> <span class="ss">&#39;color</span> <span class="nv">a-ht</span><span class="p">)</span> <span class="ss">&#39;red</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nb">remhash</span> <span class="ss">&#39;color</span> <span class="nv">a-ht</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nb">maphash</span> <span class="nf">#&#39;</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">k</span> <span class="nv">v</span><span class="p">)</span>
</span><span class='line'>       <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~A = ~A~%&quot;</span> <span class="nv">k</span> <span class="nv">v</span><span class="p">))</span>
</span><span class='line'>   <span class="nv">a-ht</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-12-29T21:45:00+00:00" pubdate data-updated="true">Dec 29<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/common-lisp/'>Common Lisp</a>, <a class='category' href='/blog/categories/lisp/'>lisp</a>


</div>
	
		<span class="comments"><a href="/blog/2012/12/29/common-lisp-ji-chu-shu-ju-jie-gou//index.html#disqus_thread">Comments</a></span>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/12/29/ying-yong-xu-he-zheng-ze-xu/">
		
			应用序和正则序</a>
	</h2>
	<div class="entry-content">
		<p>应用序和正则序主要是解释顺序上面的区别在于:<br/>
应用序首先对参数求值后再代换,
而正则序在代换完全后再归约求值.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='scheme'><span class='line'><span class="c1">;; Scheme code</span>
</span><span class='line'><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">p</span><span class="p">)</span> <span class="p">(</span><span class="nf">p</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">test</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">x</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="mi">0</span>
</span><span class='line'>      <span class="nv">y</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">test</span> <span class="mi">0</span> <span class="p">(</span><span class="nf">p</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<h2>为什么if是特殊表达式</h2>

<p>if语法是这个样子的</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='scheme'><span class='line'><span class="p">(</span><span class="k">if </span><span class="nv">predicate</span> <span class="nv">then-clause</span> <span class="nv">else-clause</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>当predicate为真的时候只对then-clause求值,而忽略else-clause.
一般的应用序表达式首先对参数求值后再求值整个语句,下面的例子说明了这个顺序差异的重要性.</p>

<figure class='code'><figcaption><span>牛顿法求平方根</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='scheme'><span class='line'><span class="c1">;; Scheme code</span>
</span><span class='line'><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">good-enough?</span> <span class="nv">guess</span> <span class="nv">x</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nb">abs </span><span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">* </span><span class="nv">guess</span> <span class="nv">guess</span><span class="p">)</span> <span class="nv">x</span><span class="p">))</span> <span class="mf">0.000000001</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">true</span>
</span><span class='line'>      <span class="nv">false</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">improve</span> <span class="nv">guess</span> <span class="nv">x</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">+ </span><span class="nv">guess</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">x</span> <span class="nv">guess</span><span class="p">))</span> <span class="mi">2</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sqrt-iter1</span> <span class="nv">guess</span> <span class="nv">x</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">good-enough?</span> <span class="nv">guess</span> <span class="nv">x</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">guess</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">sqrt-iter1</span> <span class="p">(</span><span class="nf">improve</span> <span class="nv">guess</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">x</span><span class="p">)))</span>
</span><span class='line'><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">my-if</span> <span class="nv">predicate</span> <span class="nv">then-clause</span> <span class="nv">else-clause</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if </span><span class="nv">predicate</span> <span class="nv">then-clause</span> <span class="nv">else-clause</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sqrt-iter2</span> <span class="nv">guess</span> <span class="nv">x</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">my-if</span> <span class="p">(</span><span class="nf">good-enough?</span> <span class="nv">guess</span> <span class="nv">x</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">guess</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">sqrt-iter2</span> <span class="p">(</span><span class="nf">improve</span> <span class="nv">guess</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">x</span><span class="p">)))</span>
</span><span class='line'><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">my-sqrt1</span> <span class="nv">x</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">sqrt-iter1</span> <span class="mf">2.0</span> <span class="nv">x</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">my-sqrt2</span> <span class="nv">x</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">sqrt-iter2</span> <span class="mf">2.0</span> <span class="nv">x</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>my-sqrt1可以求出正确的平方根,
而my-sqrt2因为首先对参数进行求值,而陷入无限的递归循环中去.
if表达式会首先对predicate求值,根据结果确定要求值的表达式,与一般的表达式参数求值顺序不一致,比较特殊.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-12-29T17:27:00+00:00" pubdate data-updated="true">Dec 29<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/lisp/'>lisp</a>, <a class='category' href='/blog/categories/scheme/'>scheme</a>, <a class='category' href='/blog/categories/计算机程序的构造和解释/'>计算机程序的构造和解释</a>


</div>
	
		<span class="comments"><a href="/blog/2012/12/29/ying-yong-xu-he-zheng-ze-xu//index.html#disqus_thread">Comments</a></span>
	
</div></article>

<nav id="pagenavi">
    
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    西瓜熊

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'maximaggname';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>